services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: youtube-ai-automation
    ports:
      - "6789:6789"
    environment:
      # Database
      - DATABASE_URL=file:./prisma/dev.db
      
      # NextAuth (thay đổi các giá trị này)
      - NEXTAUTH_URL=${NEXTAUTH_URL}
      - NEXTAUTH_SECRET=${NEXTAUTH_SECRET}
      
      # Google OAuth (nếu sử dụng)
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
      
      # Gemini API
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      
      # Node environment
      - NODE_ENV=production
    volumes:
      # Mount database để persist data
      - ./prisma:/app/prisma
      # Mount public uploads nếu có
      - ./public:/app/public
    restart: unless-stopped
    command: sh -c "npx prisma@6.0.1 migrate deploy && node server.js"

# Nếu muốn sử dụng PostgreSQL thay vì SQLite:
# 
# services:
#   db:
#     image: postgres:16-alpine
#     container_name: youtube-ai-db
#     environment:
#       POSTGRES_USER: ${POSTGRES_USER:-postgres}
#       POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-postgres}
#       POSTGRES_DB: ${POSTGRES_DB:-youtube_ai}
#     volumes:
#       - postgres_data:/var/lib/postgresql/data
#     ports:
#       - "5432:5432"
#     restart: unless-stopped
#
#   app:
#     build:
#       context: .
#       dockerfile: Dockerfile
#     container_name: youtube-ai-automation
#     depends_on:
#       - db
#     ports:
#       - "6789:6789"
#     environment:
#       - DATABASE_URL=postgresql://${POSTGRES_USER:-postgres}:${POSTGRES_PASSWORD:-postgres}@db:5432/${POSTGRES_DB:-youtube_ai}
#       - NEXTAUTH_URL=http://localhost:6789
#       - NEXTAUTH_SECRET=${NEXTAUTH_SECRET}
#       - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
#       - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
#       - GEMINI_API_KEY=${GEMINI_API_KEY}
#       - NODE_ENV=production
#     restart: unless-stopped
#     command: sh -c "npx prisma migrate deploy && node server.js"
#
# volumes:
#   postgres_data:
